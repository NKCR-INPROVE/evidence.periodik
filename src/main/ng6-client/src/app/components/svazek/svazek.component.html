<div class="app-svazek-wrapper grey lighten-4" *ngIf="state.configured" (click)="closeInfoOverlay()">
  <div class="app-container-left">
    
    <div class="app-table-wrapper app-left-top">
      <table mat-table [dataSource]="dsSvazek">   
        <!-- Atribut -->
        <ng-container matColumnDef="attribute">
          <th mat-header-cell *matHeaderCellDef>atribut</th>
          <td mat-cell *matCellDef="let element">{{ element | translate}}</td>
          <td mat-footer-cell *matFooterCellDef colspan="2">
            <button mz-button (click)="readClick()">
              (Znovu) načíst celý svazek
            </button>
            <button mz-button (click)="save()" [disabled]="!state.logged">
              <i *ngIf="!state.logged" mz-icon-mdi [icon]="'cancel'" [size]="'18px'" mz-tooltip [tooltip]="'Tato akce není povolená, nejste přihlášen.'" [position]="'top'"></i>
              Uložit celý svazek {{dataChanged ? '!!' : ''}}
            </button> 
          </td>
        </ng-container>

        <!-- Value -->
        <ng-container matColumnDef="value">
          <th mat-header-cell *matHeaderCellDef>hodnota</th>
          <td mat-cell *matCellDef="let element" [ngClass]="{'app-edit-text' : element !== 'titul' && element !== 'vlastnik'}">
            <ng-container [ngSwitch]="element">
              <ng-container *ngSwitchCase="'titul'">
                <mat-select [(ngModel)]="titul_idx" (ngModelChange)="setTitul()">
                  <mat-option *ngFor="let tit of state.tituly; let idx=index;" [value]="idx" >{{tit.meta_nazev}}</mat-option>
                  <mat-option [value]="-1" >{{'Add new titul' | translate}}</mat-option>
                </mat-select>
              </ng-container>
              <ng-container *ngSwitchCase="'mutace'">
                <mat-form-field>
                  <input type="text" matInput [(ngModel)]="state.currentVolume.mutace" [matAutocomplete]="auto2">
                  <i mz-icon-mdi [icon]="'pencil'"></i>
                </mat-form-field>
                  <mat-autocomplete #auto2="matAutocomplete">
                  <mat-option *ngFor="let mut of mutations;" [value]="mut.name">{{mut.name}}</mat-option>
                </mat-autocomplete>
              </ng-container>
              <ng-container *ngSwitchCase="'znak_oznaceni_vydani'">
                <mat-form-field>
                  <input type="text" matInput [(ngModel)]="state.currentVolume.znak_oznaceni_vydani" [matAutocomplete]="auto">
                  <i mz-icon-mdi [icon]="'pencil'"></i>
                </mat-form-field>
                <mat-autocomplete #auto="matAutocomplete">
                  <mat-option *ngFor="let oznaceni of oznaceni_list; let idx=index;" [value]="oznaceni.name">{{oznaceni.name}}</mat-option>
                </mat-autocomplete>
              </ng-container>
              <ng-container *ngSwitchCase="'vlastnik'">
                <mat-select [(ngModel)]="vlastnik_idx" (ngModelChange)="changeVlastnik()">
                  <mat-option *ngFor="let vlastnik of state.config.owners; let idx=index;" [value]="idx" >{{vlastnik.name}}</mat-option>
                </mat-select>
              </ng-container>
              <ng-container *ngSwitchDefault>
                <mat-form-field>
                  <input type="text" matInput [(ngModel)]="state.currentVolume[element]">
                  <i mz-icon-mdi [icon]="'pencil'"></i>
                </mat-form-field>
              </ng-container>
            </ng-container>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="0"></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="svazekColumns; sticky: true" class="app-header-row-left-top"></tr>
        <tr mat-row *matRowDef="let row; columns: svazekColumns;"></tr>
        <tr mat-footer-row *matFooterRowDef="svazekColumns; sticky: true"></tr>
      </table>
    </div><!--/.app-table-left-top -->
    
    <div class="app-table-wrapper app-left-bottom">
      <table mat-table [dataSource]="state.currentVolume.periodicita">   
        <!-- Vydani (den v tydnu) -->
        <ng-container matColumnDef="den">
          <th mat-header-cell *matHeaderCellDef>vychází</th>
          <td mat-cell *matCellDef="let element">{{ 'days.' + element.den | translate}}</td>
          <td mat-footer-cell *matFooterCellDef colspan="7">
            <button mz-button (click)="generateClick()"[disabled]="!state.logged">
              <i *ngIf="!state.logged" mz-icon-mdi [icon]="'cancel'" [size]="'18px'" mz-tooltip [tooltip]="'Tato akce není povolená, nejste přihlášen.'" [position]="'top'"></i>
              Vygenerovat / vygenerovat znovu
            </button>
          </td>
        </ng-container>
    
        <!-- Number exist -->
        <ng-container matColumnDef="active">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>číslo existuje</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox [(ngModel)]="element.active"></mat-checkbox>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="7"></td>
        </ng-container>

        <!-- Vydani -->
        <ng-container matColumnDef="vydani">
          <th mat-header-cell *matHeaderCellDef>vydání</th>
          <td mat-cell *matCellDef="let element" >
            <mat-form-field *ngIf="element.active">
              <mat-select [(ngModel)]="element.vydani">
                <mat-option *ngFor="let v of state.vydani" [value]="v">{{'record.publication.' + v | translate }}</mat-option>
              </mat-select>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="7"></td>
        </ng-container>
        
        <!-- Pocet stranek -->
        <ng-container matColumnDef="pocet_stran">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>počet stran</div>
          </th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <mat-form-field *ngIf="element.active" class="app-short-text">
              <input type="text" matInput [(ngModel)]="element.pocet_stran">
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="7"></td>
        </ng-container>

        <!-- This is attachement -->
        <ng-container matColumnDef="isPriloha">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>toto je příloha</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.active" [(ngModel)]="element.isPriloha"></mat-checkbox>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="7"></td>
        </ng-container>

        <!-- Attachement name -->
        <ng-container matColumnDef="nazev_prilohy">
          <th mat-header-cell *matHeaderCellDef>
            <div>název přílohy</div>
          </th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <mat-form-field *ngIf="element.active && element.isPriloha">
              <input type="text" matInput [(ngModel)]="element.nazev_prilohy">
              <i mz-icon-mdi [icon]="'pencil'"></i>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="7"></td>
        </ng-container>

        <!-- Button-->
        <ng-container matColumnDef="button">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>vložit další vydání</div>
          </th>
          <td mat-cell *matCellDef="let element; let idx=index">
            <i *ngIf="element.active" mz-icon-mdi [icon]="'plus-circle'" (click)="addVydani(element, idx)" mz-tooltip [tooltip]="'Vložit další vydání'" [position]="'top'"></i>
          </td>
          <td mat-footer-cell *matFooterCellDef colspan="7"></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsLeftTableBottom; sticky: true" class="app-header-row-left-bottom"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsLeftTableBottom;"></tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumnsLeftTableBottom; sticky: true"></tr>
      </table>
    </div><!--/.app-table-left-bottom -->
  </div><!--/.app-container-left -->

  <div class="app-container-right">
    <div class="app-table-wrapper app-right">
      <table mat-table [dataSource]="dsIssues">
        <!-- Edit issue -->
        <ng-container matColumnDef="edit_issue">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>editovat issue</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <i mz-icon-mdi [icon]="'newspaper'" mz-tooltip [tooltip]="'Editovat issue'" [position]="'top'" (click)="viewIssue(element.issue)"></i>
          </td>
        </ng-container> 

        <!-- Date -->
        <ng-container matColumnDef="datum_vydani">
          <th mat-header-cell *matHeaderCellDef>datum</th>
          <td mat-cell *matCellDef="let element">
            {{element.datum_vydani | date : 'EE' : '+0430' : 'cs-CZ'}} {{ element.datum_vydani }}
          </td>
        </ng-container>
    
        <!-- Number exist -->
        <ng-container matColumnDef="numExists">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>číslo existuje</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox [(ngModel)]="element.numExists"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Add next edition -->
        <ng-container matColumnDef="addNextEdition">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>přidat další vydání</div>
          </th>
          <td mat-cell *matCellDef="let element; let idx=index">
            <i mz-icon-mdi [icon]="'plus-circle'" (click)="addIssue(element, idx)" *ngIf="element.numExists" mz-tooltip [tooltip]="'Přidat další výpis'" [position]="'top'"></i>
          </td>
        </ng-container>
    
        <!-- Edition number -->
        <ng-container matColumnDef="cislo">
          <th mat-header-cell *matHeaderCellDef>číslo</th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <mat-form-field *ngIf="element.numExists" class="app-short-text">
              <input type="text" matInput [(ngModel)]="element.cislo">
            </mat-form-field>
          </td>
        </ng-container>

        <!-- Mutation -->
        <ng-container matColumnDef="mutace">
          <th mat-header-cell *matHeaderCellDef>mutace</th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <mat-form-field *ngIf="element.numExists">
              <input type="text" matInput [(ngModel)]="element.mutace">
              <i mz-icon-mdi [icon]="'pencil'"></i>
            </mat-form-field>
          </td>
        </ng-container>

        <!-- Edition -->
        <ng-container matColumnDef="vydani">
          <th mat-header-cell *matHeaderCellDef class="app-cell-edition">vydání</th>
          <td mat-cell *matCellDef="let element" class="app-cell-edition">
            <mat-form-field *ngIf="element.numExists">
              <mat-select [(ngModel)]="element.vydani">
                <mat-option *ngFor="let v of state.vydani" [value]="v">{{'record.publication.' + v | translate }}</mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <!-- This is attachement -->
        <ng-container matColumnDef="isPriloha">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>toto je příloha</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox [(ngModel)]="element.isPriloha" *ngIf="element.numExists"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Attachement name -->
        <ng-container matColumnDef="nazev_prilohy">
          <th mat-header-cell *matHeaderCellDef>
            <div>název přílohy</div>
          </th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <ng-container *ngIf="element.numExists && element.isPriloha">
              <mat-form-field>
                <input type="text" matInput [(ngModel)]="element.nazev_prilohy">
                <i mz-icon-mdi [icon]="'pencil'"></i>
              </mat-form-field>
            </ng-container>
          </td>
        </ng-container>

        <!-- Page number -->
        <ng-container matColumnDef="pocet_stran">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>počet stran</div>
          </th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <mat-form-field *ngIf="element.numExists" class="app-short-text">
              <input type="text" matInput [(ngModel)]="element.pocet_stran">
            </mat-form-field>
          </td>
        </ng-container>

        <!-- Mutation edition -->
        <ng-container matColumnDef="znak_oznaceni_vydani">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>mutační vydání</div>
          </th>
          <td mat-cell *matCellDef="let element" class="app-edit-text">
            <mat-form-field *ngIf="element.numExists" class="app-short-text">
              <input type="text" matInput [(ngModel)]="element.znak_oznaceni_vydani">
            </mat-form-field>
          </td>
        </ng-container>

        <!-- Destroyed pages -->
        <ng-container matColumnDef="destroyedPages">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>poškozené strany</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.destroyedPages"
            #dsp (mouseenter)="viewPS(element, 'destroyedPages', dsp, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Degradated -->
        <ng-container matColumnDef="degradated">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>degradované</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.degradated"
            #deg (mouseenter)="viewPS(element, 'degradated', deg, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Missing pages -->
        <ng-container matColumnDef="missingPages">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>chybí strany</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.missingPages"
            #mp (mouseenter)="viewPS(element, 'missingPages', mp, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Erroneous paging -->
        <ng-container matColumnDef="erroneousPaging">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>chybná paginace</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.erroneousPaging"
            #ep (mouseenter)="viewPS(element, 'erroneousPaging', ep, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Erroneous date -->
        <ng-container matColumnDef="erroneousDate">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>chybné datum</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.erroneousDate"
            #ed (mouseenter)="viewPS(element, 'erroneousDate', ed, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Erroneous numbering -->
        <ng-container matColumnDef="erroneousNumbering">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>chybné číslování</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.erroneousNumbering"
            #en (mouseenter)="viewPS(element, 'erroneousNumbering', en, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Wrongly bound -->
        <ng-container matColumnDef="wronglyBound">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>chybně svázáno</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.wronglyBound"
            #wb (mouseenter)="viewPS(element, 'wronglyBound', wb, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Censored -->
        <ng-container matColumnDef="censored">
          <th mat-header-cell *matHeaderCellDef class="app-cell-rotate">
            <div>cenzurováno</div>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox *ngIf="element.numExists" [(ngModel)]="element.censored"
            #cz (mouseenter)="viewPS(element, 'censored', cz, infoPopup)"></mat-checkbox>
          </td>
        </ng-container>
    
        <tr mat-header-row *matHeaderRowDef="issueColumns; sticky: true" class="app-header-row-right"></tr>
        <tr mat-row *matRowDef="let row; columns: issueColumns;" [style.background]="rowColor(row)"></tr>
      </table>
    </div>
  </div>
</div>

<ng-template #infoPopup>
  <mat-card class='popover-card'>
    <mat-card-content>
      <div><b>Popis: </b><input [(ngModel)]="popText" /></div>
      <div *ngIf="popShowPages">
        {{'record.lost_pages' | translate}}
        <ul class="app-pages">
          <li *ngFor="let page of pagesRange" class="app-page-item">
            <mz-checkbox-container>
              <input mz-checkbox [label]="page.label" type="checkbox" [id]="'pg'+page.label"
                     [(ngModel)]="page.sel" />
            </mz-checkbox-container>
          </li>
        </ul>
      </div>
    </mat-card-content>
    <button mz-button  *ngIf="popShowPages" mz-button (click)="updatePop()">update</button>
    <button mz-button  mz-button (click)="closePop()">close</button>
  </mat-card>
</ng-template>